<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

const cities = [];

let prom = fetch(endpoint)
.then(function (blob){ 
  console.log(blob); //å›å‚³response
  return blob.json();
})
.then(function(data){
  // console.log(data);
  // cities = data; å¦‚æœcitiesæ˜¯letå°±å¯ä»¥é€™æ¨£ï¼Œconstä¸èƒ½
  //cities.push(data); ç›´æ¥pushæ•´å€‹dataé™£åˆ—æœƒè®Šæˆä¸€å€‹äºŒç¶­é™£åˆ—
  cities.push(...data);
  // console.log(cities);
});
console.log(prom);//å›å‚³promise
// thençµæŸ
function findMatches(wordToMatch, cities){
  return cities.filter(function(place){
    // here we need to figure out (ææ¸…æ¥š) it the city or state matches what was searched 
    const regex = new RegExp(wordToMatch,'gi'); //RegExp ã€Œç‰©ä»¶ã€è¢«ç”¨ä¾†æ¯”å°ç¬¦åˆè‡ªè¨‚è¦å‰‡çš„æ–‡å­—ã€‚//åƒæ•¸iæ˜¯å¿½ç•¥å¤§å°å¯«ï¼Œåƒæ•¸gæ˜¯æ¯”å°å¤šæ¬¡
    return place.city.match(regex) || place.state.match(regex);
  });
}

// ä½¿ç”¨æ­£å‰‡å°‡æ•¸å­—åŠ ä¸Š,ï¼Œä¸¦å–ä»£
function numberWithCommas(x){
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,',');
}
// æ‰¾æŸ¥çš„é—œéµ
function displayMatches(){
  // console.log(this.value);
  // é€™è£¡çš„thisæ˜¯inputï¼Œå› ç‚ºæ˜¯ç›£è½inputçš„æ™‚å€™å‘¼å«ä»–çš„
  const matchArray = findMatches(this.value, cities); // å°‡æ¯”å°æˆåŠŸçš„è³‡æ–™ä¸Ÿåˆ°é€™è£¡
  console.log(matchArray);
  const html = matchArray.map(function(place){ //å†å°é€™å€‹é™£åˆ—åšè™•ç†
    //  é€™è£¡æœ‰å€‹å•é¡Œï¼Œå¦‚æœä¸Šæ–¹ç®­é ­å‡½å¼æ˜¯ç”¨ä¸€èˆ¬çš„functionä¾†å¯«ï¼Œä»–çš„thiså°±æ˜¯æŒ‡å‘windowsï¼Œä½†æ˜¯ç®­é ­å‡½å¼çš„thiså¯ä»¥ç›´æ¥æŒ‡åˆ°input.searchï¼Œæ‰€ä»¥æˆ‘æ”¹æˆç”¨function ä¸¦ä¸”this.valueæ”¹æˆsearchInput.value
    // console.log(this);
    // console.log(searchInput.value);
    const regex = new RegExp(searchInput.value, 'gi');
    // console.log(searchInput.value);
    const cityName = place.city.replace(regex,`<span class='hl'>${searchInput.value}</span>`);//replaceæœƒæ‰¾åˆ°ç¬¦åˆçš„å­—ä¸²ä¸¦ç”¨ç¬¬äºŒå€‹åƒæ•¸å–ä»£ï¼Œé€™é‚Šå°±æ˜¯æ‰¾åˆ°ç¬¦åˆè¼¸å…¥çš„å­—ä¸¦å¤šç”¨ä¸€å€‹spanå»å–ä»£
    const stateName = place.state.replace(regex,`<span class='hl'>${searchInput.value}</span>`);
    // console.log(cityName, stateName); 
    //returnçš„ `å¦‚æœæ”¾åœ¨ä¸‹ä¸€è¡Œå°±æœƒé¡¯ç¤ºä¸å‡ºä¾†å‘¢
    return `
    <li>
      <span class ="name">${cityName}, ${stateName}</span>
      <span class ="population">${numberWithCommas(place.population)}</span>
    </li>
    `;
  }).join(''); //ä½¿ç”¨joinå°‡æ¸…å–®çµ„åˆæˆä¸€æ•´å€‹å­—ä¸²//é€™é‚Šå¦‚æœæ²’æœ‰åŠ ä¸Šjoin('')çš„è©±mapæœƒå›å‚³array(typeofå‡ºä¾†æ˜¯ç‰©ä»¶)ï¼Œæ¸…å–®å°±æœƒæœ‰ã€Œ,ã€éš”é–‹()
  console.log(html);
  suggestions.innerHTML = html;
}


const searchInput = document.querySelector('.search'); //æœå°‹æ¡†
const suggestions = document.querySelector('.suggestions'); //æ¸…å–®
searchInput.addEventListener('change',displayMatches); //ä¹Ÿå¯ä»¥ç”¨keyup
searchInput.addEventListener('input',displayMatches); //ä¹Ÿå¯ä»¥ç”¨keyup


</script>
</body>
</html>
