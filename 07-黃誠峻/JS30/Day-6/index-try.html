<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
  <script>
    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
    // å‰µå»ºä¸€å€‹é™£åˆ—
    var cities = null
    // æŠ“å–è³‡æ–™å‡½æ•¸
    fetch(endpoint)
      // è½‰æ›æˆjson
      .then((blod) => blod.json())
      .then(function (data) {
        cities = data
        console.log(cities)
      })

    function numberWithCommas(x){
      // è½‰æˆå­—ä¸² 
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      //é€™ä¸€æ®µè¡¨é”å¼éå¸¸çš„è¤‡é›œä»–çš„æ„æ€æ˜¯å°‡ã€çœ‹åˆ°çš„é€™äº›éƒ½å¸å…¨éƒ¨éƒ½å–ä»£æ‰ï¼Œä»¥\Bä¾†èªªé€™è¡¨ç¤ºï¼Œè¦å°‡å¾Œé¢ç¬¦åˆæ¢ä»¶çš„éƒ¨åˆ†å–ä»£ç‚ºï¼Œã€
    }

    function check(wordToMatch, cities) {
      return cities.filter(place => {
        const regex = new RegExp(wordToMatch, "gi")//é€™å€‹wordToMatchå…¶å¯¦å°±æ˜¯æˆ‘å€‘è¼¸å…¥çš„æ•¸å€¼
        return place.city.match(regex) || place.state.match(regex)
      })

    }

    // é€²è¡Œæ¯”å°çš„åœ°æ–¹ï¼Œä½†å†é€²è¡Œæ¯”å°ä¹‹å‰æˆ‘å€‘éœ€è¦è®“ç¨‹å¼çŸ¥é“æˆ‘å€‘è¦æ¯”å°çš„å…§å®¹å› æ­¤å †æ–°å¢ä¸€å€‹checkå‡½æ•¸
    function change() {
      const matchArray = check(this.value, cities)
      // console.log(matchArray)//ç¢ºå®šå›å‚³çš„è³‡æ–™
      //joinå‡½æ•¸ï¼Œå°‡é™£åˆ—è½‰æ›æˆå­—ä¸²
      const html = matchArray.map(place => {
        // å…ˆç”¨æ­£å‰‡è¡¨é”å¼å°‡éœ€è¦æ”¹è®Šé¡è‰²çš„å­—ä¸²å†ä¸€æ¬¡åŒ¡èµ·ä¾†
        const regex = new RegExp(this.value, 'gi')
        const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
        const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
        return `
        <li>
          <span class="name">${cityName},${stateName}</span>
          <span class="population">${numberWithCommas(place.population)}</span>
      </li>`
      }).join('')
      suggestions.innerHTML=html
    }

    const search = document.querySelector(".search")
    const suggestions = document.querySelector('.suggestions');


    search.addEventListener("input", change)
  </script>
</body>

</html>